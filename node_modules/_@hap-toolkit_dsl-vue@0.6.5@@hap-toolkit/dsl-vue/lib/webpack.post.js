"use strict";const path=require("path"),fs=require("fs"),VueLoaderPlugin=require("vue-loader/lib/plugin"),MiniCssExtractPlugin=require("mini-css-extract-plugin"),{colorconsole:colorconsole}=require("@hap-toolkit/shared-utils"),Css2jsonPlugin=require("./plugin/css2json-plugin"),InstVuePlugin=require("./plugin/instvue-plugin");module.exports.postHook=function(e,{cwd:s},{loaderWrapper:r}){const o=path.resolve(s,"hap.config.js");let l;if(fs.existsSync(o))try{l=require(o)}catch(e){colorconsole.error(`加载webpack配置文件[${o}]出错：${e.message}`)}else l={module:{rules:[{test:/\.css$/,use:[MiniCssExtractPlugin.loader,"css-loader"]},{test:/\.vue$/,use:{loader:require.resolve("vue-loader"),options:{hotReload:!1,compilerOptions:{preserveWhitespace:!1}}}},{test:/\.(png|jpe?g|gif|svg|bmp|webp|mp4|wmv|avi|mpg|rmvb|mov|flv|otf|ttf|ttc|woff|eot)$/i,use:{loader:require.resolve("url-loader")}}]},plugins:[new VueLoaderPlugin,new MiniCssExtractPlugin({filename:"[name].css.json"})]};(l&&l.module&&l.module.rules||[]).forEach(s=>{s.test.exec(".vue")&&(r(s),s.use.push({loader:require.resolve("./loader/validator-loader")})),s.test.exec(".ts")&&r(s),e.module.rules.push(s)}),e.plugins.push(...l&&l.plugins||[]),e.plugins.push(new Css2jsonPlugin,new InstVuePlugin),Object.keys(e.resolve).forEach(s=>{const r=e.resolve[s];r instanceof Array?r.push(...l.resolve&&l.resolve[s]||[]):"object"==typeof r&&null!==r&&Object.assign(r,l.resolve&&l.resolve[s]||{})}),Object.keys(l&&l.resolve||{}).forEach(s=>{s in e.resolve||(e.resolve[s]=l.resolve[s])})};
//# sourceMappingURL=webpack.post.js.map
